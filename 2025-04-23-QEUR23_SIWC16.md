---
title: QEUR23_SIWC16 - 閑話休題～簡便な「知識爆発」のスキームを設計する
date: 2025-04-23
tags: ["QEUシステム", "メトリックス", "Python言語", "Unsloth", "LLM", "データセット", "BONSAI", "LangGraph"]
excerpt: あたらしいLLMの学習体系を確立する
---

## QEUR23_SIWC16 - 閑話休題～簡便な「知識爆発」のスキームを設計する

## ～ 「汎用技術構造」をLLMに丸投げ！！ ～

### ・・・ 実は、今回が結論です。さて、前回のつづきです。 ・・・

D先生： “これらの結果も、次の処理のためにDBに記録する必要がありますね。”

![imageSWC2-16-1](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-1.jpg) 

QEU:FOUNDER  ： “いままで、私たちは汎用技術構造（↑）の右側（外側）の計算をやっていました。次の処理に進むためには、テクノメトリックスの計算結果を汎用技術構造の左側（内側）のDBに入れるべきでしょう。”

D先生： “次回につづきます。・・・えっ！？これから、閑話休題なの？”

![imageSWC2-16-2](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-2.jpg) 

QEU:FOUNDER ： “今回から、やっと表の左側の解析をやります。しかし、普通のやりかたはとりません。”

![imageSWC2-16-3](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-3.jpg) 

D先生： “ひょっとして、とある筋から異端視されていた、このやり方（↓）ですか？質的データを扱う**数量化Ⅰ類**を使った？それにしても、妙なレビューですね・・・。これは静特性しか使えませんか？”

![imageSWC2-16-4](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-4.jpg) 

QEU:FOUNDER ： “もちろん動特性でもバッチリ使えます。はっきりいって、この本で提案されている数量化Ⅰ類を用いた回帰分析は、従来の変動分解法よりも**「現代的で良い」方法**ですよ。”

D先生： “現代的・・・？”

QEU:FOUNDER ： “この本の提案は、EXCELのソルバを使うというものです。すなわち、タグチメソッドの手法論が提案された当初よりも、我々が**「手に入れることができる(available)計算能力が増えた」**んです。ただし、小生は、その方法も取りません。それでは、その新しい手法を紹介するためのプログラムをドン！！”

```python
# ---
# DEEPSEEK最適化実験
import pandas as pd
from pathlib import Path

def excel_to_markdown(input_path, sheet_name=None):
    """
    ExcelファイルをMarkdown形式の文字列に変換する
    
    Args:
        input_path (str): Excelファイルのパス
        sheet_name (str, optional): 変換するシート名. Noneの場合は全シートを変換
        
    Returns:
        str: Markdown形式の文字列
    """
    input_path = Path(input_path)
    
    # ファイル存在チェック
    if not input_path.exists():
        raise FileNotFoundError(f"File not found: {input_path}")

    try:
        # Excel読み込み
        if sheet_name:
            df = pd.read_excel(input_path, sheet_name=sheet_name)
            df_dict = {sheet_name: df}
        else:
            df_dict = pd.read_excel(input_path, sheet_name=None)
    except Exception as e:
        raise ValueError(f"Excel読み込みエラー: {str(e)}")

    # Markdown変換
    markdown = []
    for sheet, df in df_dict.items():
        markdown.append(f"## {sheet}\n")
        markdown_table = df.to_markdown(index=False)
        markdown.append(markdown_table + "\n\n")
    
    return "\n".join(markdown)

# ---
input_path = "INPUT(おいしいごはん).xlsx"
markdown = excel_to_markdown(input_path):
print(markdown)

```

D先生 ： “あれ？これは、LLMに質問するために、たびたび使っているmarkdown生成プログラムですね。”

![imageSWC2-16-5](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-5.jpg) 

QEU:FOUNDER  ： “これをDEEPSEEKへのプロンプトに使うんです。”

![imageSWC2-16-6](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-6.jpg) 

QEU:FOUNDER  ： “それでは、プロンプトと出力結果を示します。”

**(INPUT)**

以下のような実験をしました。この実験データに基づいて、応答変数の量を最大とする従属変数の水準と満足度の予測値を教えてください。
また、その予測に使ったロジックをステップバイステップで記述してください。
"""
## プロジェクト名 : おいしいご飯を炊く方法を研究する

## 使用した米 : 日本のジャポニカ米

## 評価した人 : 20歳～50歳の日本人（男女10人）

## 目的 : 応答変数の量を最大とする従属変数の水準を選択する

## 応答変数(Y)

- Y : 満足度

## 従属変数（X）

- X1 : 米の量 
- X2 : 水の量 
- X3 : 追加するもの 

## 実験データ

|   NO | 米の量   | 水の量            | 追加するもの   |   満足度 |
|-----:|:---------|:------------------|:---------------|---------:|
|    1 | 3合      | 目盛より2㎜少なめ | 追加しない     |     9.75 |
|    2 | 3合      | 目盛より3㎜少なめ | 昆布           |     8.25 |
|    3 | 3合      | 目盛より4㎜少なめ | 昆布           |     8.25 |
|    4 | 3合      | 目盛より2㎜少なめ | 備長炭         |     8.5  |
|    5 | 3合      | 目盛より3㎜少なめ | 備長炭         |     8.75 |
|    6 | 3合      | 目盛どおり        | 追加しない     |     8.25 |
|    7 | 3合      | 目盛どおり        | 昆布           |     8    |
|    8 | 3合      | 目盛より2㎜少なめ | 昆布           |     9.25 |
|    9 | 3合      | 目盛より3㎜少なめ | 備長炭         |     9.75 |
|   10 | 3合      | 目盛より4㎜少なめ | 追加しない     |     8.25 |
|   11 | 3合      | 目盛より2㎜少なめ | 追加しない     |     9    |
|   12 | 5合      | 目盛より1㎜少なめ | 備長炭         |    10    |
|   13 | 3合      | 目盛より1㎜少なめ | 備長炭         |    10    |
|   14 | 4合      | 目盛より1㎜少なめ | 備長炭         |     9.75 |
|   15 | 4合      | 目盛より2㎜少なめ | 備長炭         |     9.75 |
|   16 | 5合      | 目盛より1㎜少なめ | 備長炭         |     8.75 |
|   17 | 4合      | 目盛より1㎜少なめ | 昆布と備長炭   |     9.75 |
|   18 | 3合      | 目盛どおり        | 昆布と備長炭   |    10    |
|   19 | 3合      | 目盛より1㎜少なめ | 追加しない     |     9.5  |
|   20 | 3合      | 目盛どおり        | 昆布           |     9.5  |
|   21 | 3合      | 目盛どおり        | 追加しない     |     9    |
"""

**(OUTPUT)**

### ステップバイステップのロジックと回答

1. **データの整理と最高満足度の特定**  
   - 実験データから、満足度が**10**（最大値）を記録した実験を抽出：  
     - 実験12: 5合、水少1㎜、備長炭  
     - 実験13: 3合、水少1㎜、備長炭  
     - 実験18: 3合、目盛通り、昆布と備長炭  

2. **各変数の最適水準の分析**  
   - **X1（米の量）**: 4合の平均満足度が最も高い（9.75）が、実験数が少ない（3回）。  
   - **X2（水の量）**: 「目盛より1㎜少なめ」の平均満足度が最高（9.64）。  
   - **X3（追加するもの）**: 「昆布と備長炭」の平均満足度が最高（9.875）。  

3. **交互作用の検討**  
   - 最高値10を記録した組み合わせ（実験12, 13, 18）は、いずれも「備長炭」または「昆布と備長炭」を含む。  
   - 実験18（3合、目盛通り、昆布と備長炭）は、水量調整が不要で再現性が高い。  

4. **結論**  
   - **最適な組み合わせ**: 3合、目盛通り、昆布と備長炭を追加する。  
   - **予測満足度**: **10**  

### 回答
- **従属変数の最適水準**:  
  - 米の量: **3合**  
  - 水の量: **目盛通り**  
  - 追加するもの: **昆布と備長炭**  
- **満足度の予測値**: **10**  

この組み合わせは、実験データで最大満足度を達成し、水量調整が不要で実用性が高いことが根拠です。

D先生： “なんと！？**DEEPSEEKでも、最適水準と最大満足度が出てくる**んですね！”

QEU:FOUNDER  ： “ただし、このDEEPSEEKは賢すぎて、満足度の予測値が10のままです。これは、満足度調査であるので、アンケート用紙には10以上の数字がないことを理解しているんです。それでは、次の質問に行きましょう。”

**(INPUT)**

実験上、アンケートの上限値が１０であることは理解します。ただし、実務としては最適条件でどの程度改善するかを知りたい。その実務上の要求に従い、最適条件の最大満足度（10以上）を計算してください。ステップバイステップで検討してください。

**(OUTPUT)**

### ステップバイステップ分析（外挿を考慮した予測）

---

#### **ステップ1: モデル構築の前提**
- **目的**: 実験データの範囲外（例: 水量調整の最適化や添加物の組み合わせ）を外挿し、理論上の最大満足度を推定する。  
- **仮定**:  
  - 満足度は連続変数であり、10を超える可能性がある（例: 10点満点を超えるスケールを想定）。  
  - 変数間の相互作用（例: 水量と添加物の相乗効果）が非線形である可能性を考慮。

---

#### **ステップ2: データの前処理**
1. **カテゴリ変数の数値化**:  
   - **X2（水の量）**:  
     - 目盛より1㎜少なめ = -1  
     - 目盛通り = 0  
     - 目盛より2㎜少なめ = -2  
     - 目盛より3㎜少なめ = -3  
     - 目盛より4㎜少なめ = -4  
   - **X3（追加するもの）**:  
     - 追加しない = 0  
     - 昆布 = 1  
     - 備長炭 = 2  
     - 昆布と備長炭 = 3  

2. **データ例**:  
   | NO  | X1 (合) | X2 (数値化) | X3 (数値化) | 満足度 |
   |-----|---------|-------------|-------------|--------|
   | 1   | 3       | -2          | 0           | 9.75   |
   | 12  | 5       | -1          | 2           | 10.0   |
   | 18  | 3       | 0           | 3           | 10.0   |

---

#### **ステップ3: 回帰モデルの構築**
- **モデル式**:  
  \[
  Y = \beta_0 + \beta_1 X1 + \beta_2 X2 + \beta_3 X3 + \beta_4 X2 \cdot X3 + \epsilon
  \]
  - **交互作用項（X2・X3）**: 水量と添加物の相乗効果を考慮。  

- **推定結果**:  
  | 項目          | 係数   | p値   |
  |---------------|--------|-------|
  | 切片 (\(\beta_0\)) | 8.52   | 0.001 |
  | X1            | 0.31   | 0.12  |
  | X2            | 0.45   | 0.03  |
  | X3            | 0.89   | 0.002 |
  | X2・X3        | 0.67   | 0.01  |

---

#### **ステップ4: 最適条件の探索**
1. **変数の最適化**:  
   - **X1（米の量）**: 3合（実験回数が最も多い安定条件）。  
   - **X2（水の量）**: **-0.5㎜**（目盛より0.5㎜少なめ: 実験データにない中間値）。  
   - **X3（追加するもの）**: **昆布と備長炭（3）**。  

2. **予測値の計算**:  
   \[
   \begin{align*}
   Y &= 8.52 + 0.31 \cdot 3 + 0.45 \cdot (-0.5) + 0.89 \cdot 3 + 0.67 \cdot (-0.5) \cdot 3 \\
     &= 8.52 + 0.93 - 0.225 + 2.67 - 1.005 \\
     &= 10.89
   \end{align*}
   \]

---

#### **ステップ5: モデルの信頼性検証**
- **交差検証（R²=0.82）**: モデルの説明力は高いが、外挿時の不確実性に注意が必要。  
- **感度分析**:  
  - X2を-1.0㎜に設定すると、予測値は **11.2** に上昇（ただし実験データの範囲外）。  

---

### **最終回答**
- **最適条件**:  
  - **米の量**: 3合  
  - **水の量**: 目盛より0.5㎜少なめ  
  - **追加するもの**: 昆布と備長炭  
- **満足度の予測値**: **10.9**（理論上の最大値）  

---

### 補足説明
- **外挿のリスク**:  
  - データ範囲外の予測は不確実性が高く、実際の効果は実験で検証が必要です。  
- **実務的意義**:  
  - 理論上、水量の微調整（0.5㎜少なめ）と添加物の併用で、満足度が10%以上向上する可能性があります。

D先生： “こっ・・・、これは・・・。この数式をそのまま見ると「そのまんま数量化Ⅰ類」とも言えないですね。”

![imageSWC2-16-7](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-7.jpg) 

QEU:FOUNDER ： “このDEEPSEEKが何を考えているのかはわかりません。しかし、簡単にモデルを表示すると、こうなるしかないのかなあ・・・。それにしても、モデルが交互作用の大きさも考えてくれるのはうれしいねえ。さて、プロンプトで質問した最適化問題の結果は、ここまでです。しかし、AIを使った最適化の威力は、これだけでは終わりません！！”

D先生： “もっとすごいことができるんですか？”

QEU:FOUNDER  ： “この実験は、ジャポニカ米を炊いて、J国人がメシの味を評価したことにしました。それでは、このデータを使って、**T国米を使ってT国人がメシの味を評価することができる**んです。それでは、プロンプトと結果をドン！！”

**(INPUT)**

今回の実験によって、ジャポニカ米を使い、かつ日本人が評価した場合の最適条件がわかりました。もし、この実験がタイ米を使って、タイ人が評価した場合には、どのようになると思いますか？最適条件と最大値（値1-10）で教えてください。ステップバイステップで検討してください。

**(OUTPUT)**

### ステップバイステップ分析（タイ米とタイ人評価者の場合）

---

#### **ステップ1: 米の特性の違いを考慮**
- **ジャポニカ米（日本米）**:  
  - アミロース含有量が低く、粘り気が強い。  
  - 水分吸収が比較的少ないため、**水量調整が厳密**。  
- **タイ米（インディカ米）**:  
  - アミロース含有量が高く、パサつきやすい。  
  - 水分吸収が多いため、**やや多めの水量**が必要。  

---

#### **ステップ2: タイ人の好みの推測**
- **食文化の違い**:  
  - タイ料理は、パラパラとした食感のジャスミンライスが主流。  
  - 日本のような「粘り」より「香りと軽さ」を重視。  
- **評価基準の変化**:  
  - 水分量が多すぎると「ベタつき」、少なすぎると「硬さ」を感じる可能性。  
  - 追加物の効果（例: 昆布の旨味）が評価されるか不透明。  

---

#### **ステップ3: 従属変数の再評価**
1. **X1（米の量）**:  
   - タイ米は粒が長く、同じ体積でも重量が異なる可能性。  
   - **3合**を基準としつつ、**水の量を調整**する必要あり。  

2. **X2（水の量）**:  
   - ジャポニカ米の「目盛通り」はタイ米には不適切。  
   - 実験データの「目盛より1～2㎜多め」が適切と推測。  

3. **X3（追加するもの）**:  
   - **昆布**: タイ料理では非伝統的。効果が不明。  
   - **備長炭**: 吸水調整効果は共通。  
   - **推奨**: 備長炭のみを追加し、昆布は除外。  

---

#### **ステップ4: 最適条件の推定**
- **条件の組み合わせ**:  
  - **米の量**: 3合（基準値）  
  - **水の量**: **目盛より1.5㎜多め**（ジャポニカ米比で+1.5㎜）  
  - **追加するもの**: 備長炭  

---

#### **ステップ5: 満足度の予測**
- **根拠**:  
  - タイ米の特性に合わせた水量調整で、パラパラ感を最適化。  
  - 備長炭が吸水効率を改善し、食感を安定させる。  
- **予測値**: **9.2～9.5**（10段階評価）  
  - 理由: ジャポニカ米の最高値（10）よりやや低いが、タイ米の特性と評価者の嗜好を反映。  

---

### **最終回答**
- **最適条件**:  
  - **米の量**: 3合  
  - **水の量**: 目盛より1.5㎜多め  
  - **追加するもの**: 備長炭  
- **満足度の予測値**: **9.3**（10段階評価）  

---

### 補足説明
- **不確実性の要因**:  
  - タイ米の品種（例: ジャスミンライス）やタイ人の地域差（北部と南部で好みが異なる可能性）。  
  - 追加物の文化的受容性（昆布よりレモングラスの方が好まれる可能性）。  
- **実務的アドバイス**:  
  - 現地での追加実験で、水の量と添加物を再調整することが推奨されます。

D先生： “うへえ・・・。これは、**「知識爆発」**だ！！！”

QEU:FOUNDER ： “・・・でしょう？この例題は、「TOY SCHEME」とはいえ、この方法には**「何かがある」**と思うでしょう？さらに、これらのデータがLLMの中に大量に蓄積されると何か生まれるか？”

![imageSWC2-16-8](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-8.jpg) 

D先生： “つまり、**DMAICSサイクルを回す**と、何が起こるのか？”

QEU:FOUNDER  ： “何度も言っているが、**PDCAサイクルなんて時代遅れ**なんですよ。PDCAサイクルは、今のモノづくりにおいては有害にしかならない。閉鎖的な会社の中でやれるブレークスルーは、もはやほとんどないんだ。NK国じゃあるまいし・・・。”

D先生： “その言葉は失礼です。”

![imageSWC2-16-9](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-9.jpg) 

QEU:FOUNDER  ： “そうですね。反省します。”


## ～ まとめ ～

### ・・・ 前回のつづきです ・・・

C部長： “確かにA国とJ国はモロに、赤枠の段階に入っています。しかし、C国の場合はどうかなあ・・・。ギリギリ、この領域に入ったかどうかですね。”

![imageSWC2-16-10](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-10.jpg) 

QEU:FOUNDER ： “この大チャンスで、J国はどう動くか！？J国は、自体もかなり危ういとはいえ・・・。”

![imageSWC2-16-11](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-11.jpg) 

QEU:FOUNDER ： “かなり世代交代も進んできたので、ぜひ、ガンガンと行ってもらいたい！！進むべき方針は、コレ（↓）だ！！”

[![MOVIE1](http://img.youtube.com/vi/sUdttMzVDLg/0.jpg)](http://www.youtube.com/watch?v=sUdttMzVDLg "アメリカVS中国！トランプ関税で中国との対立が激化！池亀彩・京都大学教授。安冨歩・東京大学名誉教授。")

C部長 : “残念なお知らせです。J国は、いまだに、こんな状態（↓）じゃないんですか？敬愛するA国の総統様の前で、**「E.P.の物まねをして踊る」**という・・・。”

![imageSWC2-16-12](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-12.jpg) 

QEU:FOUNDER ： “そりゃ、そうなんだけどさ・・・。ここまでくると、いやでも変わってくると思うよ。”

![imageSWC2-16-13](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-13.jpg) 

QEU:FOUNDER ： “特に**統計の単位が変わってくると、全てが変わってくる**と思うよ。この統計（↓）なんだけど、C部長が一見するとどう思う？”

![imageSWC2-16-14](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-14.jpg) 

C部長： “A国が圧倒しています！！”

![imageSWC2-16-15](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-15.jpg) 

QEU:FOUNDER ： “C部長の、その「錯覚」も、結局のところ**USDを単位として評価しているからでしょう？それを購買力(PPP)で評価**しちゃうと、C国と同じレベルになってしまうんじゃないの？”

![imageSWC2-16-16](/2025-04-23-QEUR23_SIWC16/imageSWC2-16-16.jpg) 

D先生： “そういえば、最近、すごいニュースがありますからね。”

QEU:FOUNDER ： “Google Colabでは、40GB以上のGPUが使えなかったですからね。そのため、32b以上のLLMモデルのFT学習ができなかったんです。早く、新GPUを使ったサービスを立ち上げてほしい。安価でお願いします。”
